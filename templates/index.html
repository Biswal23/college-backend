<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="{{ seo.title }}">
    <meta name="description" content="{{ seo.description }}">
    <meta name="keywords" content="{{ seo.keywords }}">
    <meta property="og:title" content="{{ seo.og_title }}">
    <meta property="og:description" content="{{ seo.og_description }}">
    <meta property="og:url" content="{{ seo.og_url }}">
    <meta name="twitter:card" content="{{ seo.twitter_card }}">
    <title>{{ seo.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        @media (max-width: 640px) {
            th, td { font-size: 0.875rem; padding: 6px; }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4 text-center">Find Colleges in India</h1>

        <!-- Existing Search Form -->
        <form action="/" method="post" class="mb-8 bg-white p-6 rounded shadow">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="course_level" class="block text-sm font-medium">Course Level</label>
                    <select name="course_level" id="course_level" required class="mt-1 block w-full border-gray-300 rounded">
                        <option value="BTech" {% if form_data.course_level == 'BTech' %}selected{% endif %}>BTech</option>
                        <option value="Diploma" {% if form_data.course_level == 'Diploma' %}selected{% endif %}>Diploma</option>
                        <option value="Degree" {% if form_data.course_level == 'Degree' %}selected{% endif %}>Degree</option>
                    </select>
                </div>
                <div>
                    <label for="state" class="block text-sm font-medium">State</label>
                    <input type="text" name="state" id="state" value="{{ form_data.state }}" list="state-suggestions" class="mt-1 block w-full border-gray-300 rounded">
                    <datalist id="state-suggestions">
                        {% for state in suggestions.state %}
                            <option value="{{ state }}">
                        {% endfor %}
                    </datalist>
                </div>
                <div>
                    <label for="location" class="block text-sm font-medium">Location</label>
                    <input type="text" name="location" id="location" value="{{ form_data.location }}" list="location-suggestions" class="mt-1 block w-full border-gray-300 rounded">
                    <datalist id="location-suggestions">
                        {% for location in suggestions.location %}
                            <option value="{{ location }}">
                        {% endfor %}
                    </datalist>
                </div>
                <div>
                    <label for="college_name" class="block text-sm font-medium">College Name</label>
                    <input type="text" name="college_name" id="college_name" value="{{ form_data.college_name }}" list="college-suggestions" class="mt-1 block w-full border-gray-300 rounded">
                    <datalist id="college-suggestions">
                        {% for name in suggestions.college_name %}
                            <option value="{{ name }}">
                        {% endfor %}
                    </datalist>
                </div>
                <div>
                    <label for="branch" class="block text-sm font-medium">Branch</label>
                    <input type="text" name="branch" id="branch" value="{{ form_data.branch }}" list="branch-suggestions" class="mt-1 block w-full border-gray-300 rounded">
                    <datalist id="branch-suggestions">
                        {% for branch in suggestions.branch %}
                            <option value="{{ branch }}">
                        {% endfor %}
                    </datalist>
                </div>
                <div>
                    <label for="fees" class="block text-sm font-medium">Fees</label>
                    <input type="number" name="fees" id="fees" value="{{ form_data.fees }}" class="mt-1 block w-full border-gray-300 rounded">
                </div>
                <div>
                    <label for="score" class="block text-sm font-medium">Score</label>
                    <input type="number" name="score" id="score" value="{{ form_data.score }}" class="mt-1 block w-full border-gray-300 rounded">
                </div>
            </div>
            <button type="submit" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Search</button>
        </form>

        <!-- New Score Filter Form for /predict_colleges/ -->
        <form action="/predict_colleges/" method="get" class="mb-8 bg-white p-6 rounded shadow">
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <label for="score" class="text-sm font-medium">Enter Your Score:</label>
                <input type="number" name="score" id="score" required class="border-gray-300 rounded px-2 py-1">
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Search Colleges</button>
            </div>
        </form>

        <!-- Results Display -->
        {% if error %}
            <p class="text-red-500 mb-4">{{ error }}</p>
        {% endif %}
        {% if success_message %}
            <p class="text-green-500 mb-4">{{ success_message }}</p>
        {% endif %}
        {% if results %}
            {% if use_table %}
                <div class="table-container">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>State</th>
                                <th>Location</th>
                                <th>Course</th>
                                <th>Branch</th>
                                <th>Min Score</th>
                                <th>Max Score</th>
                                <th>Fees</th>
                                <th>Rating</th>
                                <th>Reviews</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in results %}
                                <tr>
                                    <td>{{ result.name }}</td>
                                    <td>{{ result.state }}</td>
                                    <td>{{ result.location }}</td>
                                    <td>{{ result.course_level }}</td>
                                    <td>{{ result.branch }}</td>
                                    <td>{{ result.min_score }}</td>
                                    <td>{{ result.max_score }}</td>
                                    <td>{{ result.fees }}</td>
                                    <td>{{ result.avg_rating | round(1) }}</td>
                                    <td>
                                        {% for review in result.reviews %}
                                            <p>{{ review.review_text }} ({{ review.rating }})</p>
                                        {% endfor %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                {% for result in results %}
                    <div class="bg-white p-4 mb-4 rounded shadow">
                        <h2 class="text-xl font-bold">{{ result.name }}</h2>
                        <p><strong>State:</strong> {{ result.state }}</p>
                        <p><strong>Location:</strong> {{ result.location }}</p>
                        <p><strong>Course:</strong> {{ result.course_level }}</p>
                        <p><strong>Branch:</strong> {{ result.branch }}</p>
                        <p><strong>Score Range:</strong> {{ result.min_score }} - {{ result.max_score }}</p>
                        <p><strong>Fees:</strong> {{ result.fees }}</p>
                        <p><strong>Rating:</strong> {{ result.avg_rating | round(1) }}</p>
                        <p><strong>Reviews:</strong></p>
                        {% for review in result.reviews %}
                            <p>{{ review.review_text }} ({{ review.rating }})</p>
                        {% endfor %}
                    </div>
                {% endfor %}
            {% endif %}
        {% endif %}
    </div>

    <script>
        // Client-side filtering (simplified example)
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    // Implement client-side filtering if needed
                    console.log('Input changed:', input.name, input.value);
                });
            });
        });
    </script>
</body>
</html>
